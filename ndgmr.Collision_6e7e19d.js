this.ndgmr=this.ndgmr||{},function(){var e=document.createElement("canvas"),t=e.getContext("2d");t.save();var i=document.createElement("canvas"),r=i.getContext("2d");r.save();var h=[],a=function(e,t){var i,r;return i=m(e),r=m(t),s(i,r)};ndgmr.checkRectCollision=a;var n=function(h,n,x,s){(ndgmr.DEBUG||ndgmr.DEBUG_COLLISION)&&(document.body.appendChild(e),document.body.appendChild(i)),s=s||!1;var m,d,l,y;return(m=c(h,n))?(intersection=a(h,n))?(x=x||0,x=Math.min(.99999,x),e.width=intersection.width,e.height=intersection.height,i.width=intersection.width,i.height=intersection.height,d=g(intersection,h,t,1),l=g(intersection,n,r,2),(y=o(d,l,intersection.width,intersection.height,x,s))?(y.x+=intersection.x,y.x2+=intersection.x,y.y+=intersection.y,y.y2+=intersection.y,y):!1):!1:!1};ndgmr.checkPixelCollision=n;var c=function(e,t){var i,r,h,a;return h=e.localToGlobal(0,0),a=t.localToGlobal(0,0),i=e instanceof createjs.Bitmap?{width:e.image.width,height:e.image.height}:e.spriteSheet.getFrame(e.currentFrame).rect,r=t instanceof createjs.Bitmap?{width:t.image.width,height:t.image.height}:t.spriteSheet.getFrame(t.currentFrame).rect,Math.abs(a.x-h.x)<r.width*t.scaleX+i.width*e.scaleX&&Math.abs(a.y-h.y)<r.height*t.scaleY+i.height*t.scaleY},g=function(e,t,i,r){var a,n,c,g;return t instanceof createjs.Bitmap?n=t.image:t instanceof createjs.Sprite&&(frame=t.spriteSheet.getFrame(t.currentFrame),c=frame.image.src+":"+frame.rect.x+":"+frame.rect.y+":"+frame.rect.width+":"+frame.rect.height,h[c]?n=h[c]:h[c]=n=createjs.SpriteSheetUtils.extractFrame(t.spriteSheet,t.currentFrame)),a=t.globalToLocal(e.x,e.y),i.restore(),i.save(),i.rotate(x(t,"rotation")*(Math.PI/180)),i.scale(x(t,"scaleX","*"),x(t,"scaleY","*")),i.translate(-a.x-e["rect"+r].regX,-a.y-e["rect"+r].regY),void 0!=(g=t.sourceRect)?i.drawImage(n,g.x,g.y,g.width,g.height,0,0,g.width,g.height):i.drawImage(n,0,0,n.width,n.height),i.getImageData(0,0,e.width,e.height).data},o=function(e,t,i,r,h,a){var n,c,g,o,x=3,s={x:1/0,y:1/0,x2:-1/0,y2:-1/0};for(o=0;r>o;++o)for(g=0;i>g;++g){if(n=e.length>x+1?e[x]/255:0,c=t.length>x+1?t[x]/255:0,n>h&&c>h){if(!a)return{x:g,y:o,width:1,height:1};g<s.x&&(s.x=g),g>s.x2&&(s.x2=g),o<s.y&&(s.y=o),o>s.y2&&(s.y2=o)}x+=4}return 1/0!=s.x?(s.width=s.x2-s.x+1,s.height=s.y2-s.y+1,s):null},x=function(e,t,i){if(i=i||"+",e.parent&&e.parent[t]){var r=e[t],h=x(e.parent,t,i);return"*"==i?r*h:r+h}return e[t]},s=function(e,t){var i,r,h={},a={};return h.cx=e.x+(h.hw=e.width/2),h.cy=e.y+(h.hh=e.height/2),a.cx=t.x+(a.hw=t.width/2),a.cy=t.y+(a.hh=t.height/2),i=Math.abs(h.cx-a.cx)-(h.hw+a.hw),r=Math.abs(h.cy-a.cy)-(h.hh+a.hh),0>i&&0>r?(i=Math.min(Math.min(e.width,t.width),-i),r=Math.min(Math.min(e.height,t.height),-r),{x:Math.max(e.x,t.x),y:Math.max(e.y,t.y),width:i,height:r,rect1:e,rect2:t}):null};ndgmr.calculateIntersection=s;var m=function(e){var t={x:1/0,y:1/0,width:0,height:0};if(e instanceof createjs.Container){t.x2=-1/0,t.y2=-1/0;var i,r,h=e.children,a=h.length;for(r=0;a>r;r++)i=m(h[r]),i.x<t.x&&(t.x=i.x),i.y<t.y&&(t.y=i.y),i.x+i.width>t.x2&&(t.x2=i.x+i.width),i.y+i.height>t.y2&&(t.y2=i.y+i.height);1/0==t.x&&(t.x=0),1/0==t.y&&(t.y=0),1/0==t.x2&&(t.x2=0),1/0==t.y2&&(t.y2=0),t.width=t.x2-t.x,t.height=t.y2-t.y,delete t.x2,delete t.y2}else{var n,c,g,o,x,s={};if(e instanceof createjs.Bitmap)x=e.sourceRect||e.image,s.width=x.width,s.height=x.height;else if(e instanceof createjs.Sprite)if(e.spriteSheet._frames&&e.spriteSheet._frames[e.currentFrame]&&e.spriteSheet._frames[e.currentFrame].image){var d=e.spriteSheet.getFrame(e.currentFrame);s.width=d.rect.width,s.height=d.rect.height,s.regX=d.regX,s.regY=d.regY}else t.x=e.x||0,t.y=e.y||0;else t.x=e.x||0,t.y=e.y||0;s.regX=s.regX||0,s.width=s.width||0,s.regY=s.regY||0,s.height=s.height||0,t.regX=s.regX,t.regY=s.regY,n=e.localToGlobal(0-s.regX,0-s.regY),c=e.localToGlobal(s.width-s.regX,s.height-s.regY),g=e.localToGlobal(s.width-s.regX,0-s.regY),o=e.localToGlobal(0-s.regX,s.height-s.regY),t.x=Math.min(Math.min(Math.min(n.x,c.x),g.x),o.x),t.y=Math.min(Math.min(Math.min(n.y,c.y),g.y),o.y),t.width=Math.max(Math.max(Math.max(n.x,c.x),g.x),o.x)-t.x,t.height=Math.max(Math.max(Math.max(n.y,c.y),g.y),o.y)-t.y}return t};ndgmr.getBounds=m}();